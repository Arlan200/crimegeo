const map = L.map('map', {
  zoomControl: false // отключаем кнопки + и -
}).setView([49.95, 82.61], 13);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(map);

  // Данные за 2020
  const data2020 = {
    "Жесткие преступления": [
        {"type":"изготовление и перевозка н","coords":[82.61296870014547,49.95166830005206],"Дата":"03.12.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.59970260009499,49.94969470005043],"Дата":"19.08.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.60362579989084,49.94759330009077],"Дата":"23.10.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.6117723994767,49.95632179971136],"Дата":"12.08.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.61334709584798,49.96073412696582],"Дата":"16.06.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.6166695746957,49.94537499592011],"Дата":"15.08.2020","Место":"другое мес"},
        {"type":"убийство","coords":[82.59806589962164,49.98040970004769],"Дата":"27.10.2020","Место":"квартира"},
        {"type":"убийство","coords":[82.60792709985583,49.96903719990689],"Дата":"30.01.2020","Место":"кафе"},
        {"type":"убийство","coords":[82.5847810001431,49.96175209957977],"Дата":"07.10.2020","Место":"другое мес"},
        {"type":"убийство","coords":[82.58246250024428,49.97055819990106],"Дата":"04.09.2020","Место":"другое мес"},
        {"type":"убийство","coords":[82.553926464329,49.97904740269929],"Дата":"12.09.2020","Место":"коммунальн"},
        {"type":"убийство","coords":[82.6399534975342,49.92664215350671],"Дата":"14.08.2020","Место":""},
        {"type":"убийство","coords":[82.62038890022762,49.927900599732936],"Дата":"06.08.2020","Место":"овраг"},
        {"type":"убийство","coords":[82.68032989990502,49.947644299744695],"Дата":"21.06.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.64057500013621,49.95311490003269],"Дата":"17.10.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.6424124912941,49.948671160175394],"Дата":"30.05.2020","Место":"другое мес"},
        {"type":"изготовление и перевозка н","coords":[82.65305069369691,49.94699577742904],"Дата":"05.06.2020","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.65361569737223,49.94476433945694],"Дата":"22.05.2020","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.65017017341,49.94534517506566],"Дата":"07.10.2020","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63392290046518,49.95397163685675],"Дата":"","Место":"квартира"},
        {"type":"изготовление и перевозка н","coords":[82.63583400003915,49.94876020012322],"Дата":"30.07.2020","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.633999499977,49.94831740002803],"Дата":"25.09.2020","Место":"подвал"},
        {"type":"изготовление и перевозка н","coords":[82.62488589986447,49.952292699348675],"Дата":"24.11.2020","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.66236679998786,49.94869869998507],"Дата":"14.11.2020","Место":""}
    ],
    "Тяжкие преступления": [
        {"type":"грабеж","coords":[82.60049248292103,49.966723362189555],"Дата":"11.06","Место":"улица"},
        {"type":"грабеж","coords":[82.61292450116915,49.964925723889294],"Дата":"10.03","Место":"улица"},
        {"type":"причинение тяжкого вреда з","coords":[82.61123639993997,49.96335630976039],"Дата":"01.03","Место":"переулок"},
        {"type":"разбой","coords":[82.59472009965293,49.94835979946521],"Дата":"01.04","Место":"квартира"},
        {"type":"кража","coords":[82.59884159995994,49.94648109952317],"Дата":"06.09","Место":"склад"},
        {"type":"хулиганство","coords":[82.59996909979418,49.94959849957115],"Дата":"30.08","Место":"ночной клуб"},
        {"type":"кража","coords":[82.61239179944204,49.9633262719877],"Дата":"20.09","Место":"транспорт личный"},
        {"type":"изготовление и перевозка з","coords":[82.5915598001447,49.94882640011832],"Дата":"19.04","Место":"другое место"},
        {"type":"изготовление и перевозка з","coords":[82.5918256999961,49.948397599769464],"Дата":"23.04","Место":"другое место"},
        {"type":"изготовление и перевозка з","coords":[82.60902952940954,49.96277649740883],"Дата":"19.05","Место":"подвал здания"},
        {"type":"кража","coords":[82.60970464306932,49.961167179093664],"Дата":"08.08","Место":"улица"},
        {"type":"кража","coords":[82.59126249956478,49.94746869992059],"Дата":"26.01","Место":"аптека"},
        {"type":"грабеж","coords":[82.64483739992613,49.948522499413855],"Дата":"15.03.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.61424009960098,49.964573899665766],"Дата":"10.03.2020","Место":"квартира"},
        {"type":"грабеж","coords":[82.59491940021019,49.96762339999998],"Дата":"01.01.2020","Место":"прочие уличные"},
        {"type":"грабеж","coords":[82.59366589996137,49.961807599441215],"Дата":"29.06.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.59679570951239,49.957225993890475],"Дата":"22.03.2020","Место":"прочие уличные"},
        {"type":"грабеж","coords":[82.59570450026251,49.97146159947329],"Дата":"11.11.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.58286050986777,49.96830942517601],"Дата":"12.06.2020","Место":"магазин частный"},
        {"type":"грабеж","coords":[82.58237180026671,49.96553523691627],"Дата":"17.08.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.58488769899742,49.97224210162152],"Дата":"30.05.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.63563045809926,49.95633859275404],"Дата":"22.10.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.6107743003937,49.957295600012],"Дата":"15.10.2020","Место":"двор дома"},
        {"type":"грабеж","coords":[82.60648340307431,49.95040467406645],"Дата":"13.09.2020","Место":"магазин частный"},
        {"type":"грабеж","coords":[82.61157657676607,49.94437149451531],"Дата":"27.01","Место":"магазин частный"},
        {"type":"грабеж","coords":[82.61068695814538,49.966520066213825],"Дата":"12.11.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.61530460012727,49.960178199664256],"Дата":"25.09.2020","Место":"улица"},
        {"type":"грабеж","coords":[82.60795033683547,49.95452338194356],"Дата":"03.10.2020","Место":"другое место"},
        {"type":"причинение тяжкого вреда з","coords":[82.61133709972745,49.95486570019199],"Дата":"29.03.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.60911431754121,49.955212141472714],"Дата":"28.05.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.6102238001883,49.95802570022596],"Дата":"12.11.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.61347861816478,49.957824855837615],"Дата":"26.01.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.61883100015058,49.95962420019674],"Дата":"07.01.2020","Место":"двор дома"},
        {"type":"причинение тяжкого вреда з","coords":[82.60862831594298,49.9633835933234],"Дата":"05.04.2020","Место":"прочие уличные"},
        {"type":"причинение тяжкого вреда з","coords":[82.61239207198389,49.96169589604587],"Дата":"12.11.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.61676669992335,49.96290779945542],"Дата":"12.09.2020","Место":"квартира"},
        {"type":"причинение тяжкого вреда з","coords":[82.6173391156901,49.96509374702724],"Дата":"16.01.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.6173391156901,49.96509374702724],"Дата":"03.03.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.61257109997632,49.957257899532465],"Дата":"12.11.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.64291924050555,49.95112662253898],"Дата":"24.08.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.64747840030799,49.952226699902326],"Дата":"20.03.2020","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.64861820016984,49.94822819987161],"Дата":"30.09.2020","Место":"двор дома"},
        {"type":"причинение тяжкого вреда з","coords":[82.66098630017768,49.95155430019088],"Дата":"20.03.2020","Место":"дом"},
        {"type":"причинение тяжкого вреда з","coords":[82.6587207002002,49.9520276997186],"Дата":"19.03.2020","Место":"квартира"},
        {"type":"причинение тяжкого вреда з","coords":[82.66347350030185,49.949376699774916],"Дата":"19.04.2020","Место":"дом"},
        {"type":"причинение тяжкого вреда з","coords":[82.66163049984777,49.9477508999841],"Дата":"24.05.2020","Место":"дом"},
        {"type":"разбой","coords":[82.53267729981758,50.01452389995808],"Дата":"06.11.2020","Место":"улица"},
        {"type":"разбой","coords":[82.52769959995663,50.0165580000517],"Дата":"06.11.2020","Место":"улица"},
        {"type":"разбой","coords":[82.59349459979597,49.95897789971036],"Дата":"18.09.2020","Место":"улица"},
        {"type":"разбой","coords":[82.60992570011103,49.96404870008752],"Дата":"18.09.2020","Место":"улица"},
        {"type":"разбой","coords":[82.62893429967824,49.953671699989],"Дата":"14.12.2020","Место":"подъезд дома"},
        {"type":"разбой","coords":[82.63189162731294,49.95062356263159],"Дата":"03.04.2020","Место":"квартира"}
    ]
  };

  // Данные за 2024
  const data2024 = {
    "Жесткие преступления": [
        {"type":"убийство","coords":[82.61381690022984,49.95712249940385],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.59974973892561,49.95453550843844],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.59381710027901,49.95877579956357],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.60851920000113,49.94838439952048],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.6429583996105,49.95751360017255],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.63604080004296,49.95498740004854],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.64860490009613,49.94833189979738],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.60973542909574,49.95843407027223],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.6028400605494,49.958555513263065],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.60186187684681,49.95541440110133],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.58134448241182,49.96159160495943],"Дата":"","Место":""},
        {"type":"убийство","coords":[82.61021189945967,49.97488819993055],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.60366759948016,49.947390799745676],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61492247046336,49.94942207809811],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61492247046336,49.94942207809811],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61498908253594,49.94938057331093],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61857217657423,49.945924658642156],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61861776056983,49.94596009811506],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61967260011045,49.94478430005546],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.61967260011045,49.94478430005546],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.62974887597267,49.95237513479209],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63025296387895,49.95185787433513],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63025296387895,49.95185787433513],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.62367649967081,49.945784699604246],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.62549630031407,49.9440961999797],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63542009965795,49.949354599834976],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63542009965795,49.949354599834976],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63720400026443,49.949273400047446],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63717755641532,49.94929134352322],"Дата":"","Место":""},
        {"type":"изготовление и перевозка н","coords":[82.63542009965795,49.949354599834976],"Дата":"","Место":""}
        ],
    "Тяжкие преступления": [
        {"type":"причинение тяжкого вреда з","coords":[82.60793220830337,49.96226714363388],"Дата":"29.02.2024","Место":"квартира"},
        {"type":"причинение тяжкого вреда з","coords":[82.60517950013389,49.957864600171206],"Дата":"13.08.2024","Место":"улица"},
        {"type":"причинение тяжкого вреда з","coords":[82.59930440007804,49.96745279950716],"Дата":"31.01.2024","Место":"учебное заведен"},
        {"type":"причинение тяжкого вреда з","coords":[82.59878970008464,49.96695160013627],"Дата":"29.07.2024","Место":"квартира"},
        {"type":"причинение тяжкого вреда з","coords":[82.61387493647739,49.95889499186065],"Дата":"02.08.2024","Место":"прочие уличные"},
        {"type":"причинение тяжкого вреда з","coords":[82.60996589980647,49.97039909993856],"Дата":"18.04.2024","Место":"дом"},
        {"type":"причинение тяжкого вреда з","coords":[82.61893760038998,49.9519383997374],"Дата":"08.05.2024","Место":"двор дома"},
        {"type":"причинение тяжкого вреда з","coords":[82.63439043175468,49.95486531178018],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.61262819973172,49.95192419944232],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.63276480005555,49.95324899974162],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.63249451956722,49.95293031011255],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.6198101999808,49.96059160002238],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.5999840995866,49.96762319945117],"Дата":"","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.62556120547818,49.95388281139145],"Дата":"01.08.2024","Место":""},
        {"type":"причинение тяжкого вреда з","coords":[82.62728159926668,49.94538804209229],"Дата":"06.02.2024","Место":"прочие уличные"},
        {"type":"кража","coords":[82.60090871787759,49.953897458675556],"Дата":"","Место":""},
        {"type":"кража","coords":[82.58321597210579,49.953620367939635],"Дата":"","Место":""},
        {"type":"кража","coords":[82.59032100021403,49.953451500086715],"Дата":"","Место":""},
        {"type":"кража","coords":[82.58232172665907,49.95714879477186],"Дата":"","Место":""},
        {"type":"кража","coords":[82.59349459979597,49.95897789971036],"Дата":"","Место":""},
        {"type":"кража","coords":[82.5946149994827,49.959432099611774],"Дата":"","Место":""},
        {"type":"кража","coords":[82.59275153997254,49.961627052511744],"Дата":"","Место":""},
        {"type":"кража","coords":[82.59359009970342,49.96144800012513],"Дата":"","Место":""},
        {"type":"кража","coords":[82.59435891625355,49.95415675478371],"Дата":"","Место":""},
        {"type":"кража","coords":[82.58731090007802,49.96258100021305],"Дата":"","Место":""},
        {"type":"кража","coords":[82.58434133335271,49.96333182898769],"Дата":"","Место":""},
        {"type":"кража","coords":[82.57622110002382,49.96497309972881],"Дата":"","Место":""},
        {"type":"кража","coords":[82.63427099990679,49.95170720022719],"Дата":"","Место":""},
        {"type":"кража","coords":[82.6419645057185,49.95725975700154],"Дата":"","Место":"квартира"},
        {"type":"кража","coords":[82.63805939942182,49.958442400196645],"Дата":"","Место":"подъезд дома"},
        {"type":"кража","coords":[82.63845502431585,49.95323580864556],"Дата":"","Место":"салон авто"},
        {"type":"кража","coords":[82.63006566324523,49.951640814291906],"Дата":"14.03.2024","Место":"торговый дом"},
        {"type":"кража","coords":[82.63006566324523,49.951640814291906],"Дата":"13.03.2024","Место":""},
        {"type":"кража","coords":[82.62670929959455,49.96014410007024],"Дата":"27.06.2024","Место":"квартира"},
        {"type":"кража","coords":[82.64849849950622,49.95000749954653],"Дата":"","Место":""},
        {"type":"кража","coords":[82.64825819975619,49.946323899828144],"Дата":"","Место":""},
        {"type":"кража","coords":[82.65079979987092,49.945149699998694],"Дата":"","Место":""},
        {"type":"кража","coords":[82.61396489986032,49.961500599673],"Дата":"","Место":""},
        {"type":"кража","coords":[82.64879110022918,49.95256999990562],"Дата":"","Место":""},
        {"type":"кража","coords":[82.62740967623408,49.94336529294895],"Дата":"","Место":""},
        {"type":"кража","coords":[82.6274695001174,49.94432889955914],"Дата":"","Место":""},
        {"type":"кража","coords":[82.62837139962045,49.94653989989649],"Дата":"","Место":""},
        {"type":"кража","coords":[82.63029299992206,49.948751799555964],"Дата":"","Место":""},
        {"type":"кража","coords":[82.61779149987785,49.94261119984702],"Дата":"","Место":""},
        {"type":"кража","coords":[82.61188994176578,49.945205734633085],"Дата":"","Место":""},
        {"type":"кража","coords":[82.6102238001883,49.95802570022596],"Дата":"","Место":""},
        {"type":"кража","coords":[82.60789579985135,49.96009719952622],"Дата":"","Место":""},
        {"type":"доведение до самоубийства","coords":[82.6192012035703,49.94177798458391],"Дата":"","Место":""},
        {"type":"доведение до самоубийства","coords":[82.60609030022721,49.946926700107156],"Дата":"","Место":""},
        {"type":"доведение до самоубийства","coords":[82.6257555002162,49.95481529948654],"Дата 23":"","Место ":""},
        {"type":"доведение до самоубийства","coords":[82.63378960158742,49.95717635490455],"Дата":"","Место":""},
        {"type":"доведение до самоубийства","coords":[82.61339799961803,49.95870629995585],"Дата":"","Место":""},
        {"type":"доведение до самоубийства","coords":[82.61700069188723,49.96502800522633],"Дата":"07.05.2024","Место":"квартира"},
        {"type":"доведение до самоубийства","coords":[82.60944385864696,49.958492555857106],"Дата":"02.11.2024","Место":""},
        {"type":"грабеж","coords":[82.626139784941,49.95552490323226],"Дата":"","Место":""},
        {"type":"грабеж","coords":[82.61360230040589,49.955604799921616],"Дата":"","Место":""},
        {"type":"грабеж","coords":[82.60553495444537,49.95790636496126],"Дата":"","Место":""},
        {"type":"грабеж","coords":[82.60376313893147,49.96338738782508],"Дата":"","Место":""}
]
  };

  let currentData = data2020;
  let currentMarkers = [];

  function clearMarkers() {
    currentMarkers.forEach(m => map.removeLayer(m));
    currentMarkers = [];
  }

  function showTypes(category) {
    const typesDiv = document.getElementById('types');
    typesDiv.innerHTML = '';
    const typesSet = new Set(currentData[category].map(item => item.type));
    typesSet.forEach(type => {
      const div = document.createElement('div');
      div.className = 'type';
      div.textContent = type;
      div.onclick = () => showMarkers(category, type);
      typesDiv.appendChild(div);
    });
  }

  function showMarkers(category, type) {
    clearMarkers();
    currentData[category].filter(item => item.type === type && item.coords).forEach(item => {
      const marker = L.marker([item.coords[1], item.coords[0]]).addTo(map);
      marker.bindPopup(`<b>${item.type}</b><br>Дата: ${item.Дата}<br>Место: ${item.Место}`);
      currentMarkers.push(marker);
    });
  }

  document.querySelectorAll('.category').forEach(cat => {
    cat.addEventListener('click', () => showTypes(cat.dataset.category));
  });

  document.getElementById('yearSelect').addEventListener('change', (e) => {
    const year = e.target.value;
    currentData = year === '2020' ? data2020 : data2024;
    clearMarkers();
    document.getElementById('types').innerHTML = '';
  });

const mapContainer = document.getElementById('mapContainer');
const expandBtn = document.getElementById('expandMap');

expandBtn.addEventListener('click', () => {
  const isFullscreen = mapContainer.classList.toggle('fullscreen');

  if (isFullscreen) {
    expandBtn.textContent = 'Свернуть';
  } else {
    expandBtn.textContent = 'Развернуть';
  }

  // Leaflet иногда нужно немного подождать, чтобы корректно пересчитать размеры
  setTimeout(() => {
    map.invalidateSize();
  }, 200); // 200 мс обычно достаточно
});

// Пример данных по категориям (можно использовать реальные числа)
const chartData = {
  "Жесткие преступления": [5, 3, 2], // например: убийства, кражи, другое
  "Тяжкие преступления": [10, 7, 4],
};

// Подписи секторов
const chartLabels = ["Убийства", "Кражи", "Другое"];
